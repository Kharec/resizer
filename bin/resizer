#!/usr/bin/perl -w
# Made by Sandro CAZZANIGA <cazzaniga.sandro@gmail.com>
# 09/12/2012
# Provide a simple tool to resize a lot of picture in one shot

use strict;
use File::Find::Rule;
use Imager;

print("Example: $0 JPG 1024x768\n") and exit(1) if (@ARGV != 2);

my $extension = $ARGV[0];
$ARGV[1] =~ /(\d+)x(\d+)/;
my ($newSizeX, $newSizeY) = ($1, $2);

my $i = 1;

my $worker = Imager->new();
my $find = File::Find::Rule->new();

$find->file;
$find->name("*.$extension");
my @pictures = $find->in($ENV{PWD});
print("$#pictures files... \n");

foreach my $pic (@pictures) {
    print("$i: $pic => ");
    my $img = $worker->read(file => $pic) or die("Can't read $pic!");
    my $newImg = $img->scale(xpixels=>$newSizeX, ypixels=>$newSizeY) or die $img->errstr;
    $newImg->write(file => $pic) or die("Something wrong happened to $pic!");
    print("OK\n");
    $i++;
}

exit(0);
